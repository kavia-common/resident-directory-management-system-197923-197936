{"is_source_file": true, "format": "Python", "description": "This file defines API routes and handlers for user authentication, including registration, login, token refresh, and logout, using FastAPI, SQLAlchemy ORM, and JWT tokens.", "external_files": ["src.api.core.security", "src.api.db.session", "src.api.models.refresh_token", "src.api.models.user", "src.api.schemas.auth"], "external_methods": ["create_access_token", "create_refresh_token", "hash_password", "verify_password", "decode_token", "get_db"], "published": ["router"], "classes": [{"name": "RefreshToken", "description": "SQLAlchemy model representing refresh tokens stored in the database."}, {"name": "User", "description": "SQLAlchemy model representing user accounts in the database."}, {"name": "UserPublic", "description": "Pydantic schema for exposing user data publicly."}, {"name": "TokenResponse", "description": "Pydantic schema for the token response containing access and refresh tokens."}, {"name": "LoginRequest", "description": "Schema for login request payload."}, {"name": "LogoutRequest", "description": "Schema for logout request payload."}, {"name": "RefreshRequest", "description": "Schema for refresh token request payload."}, {"name": "RegisterRequest", "description": "Schema for user registration request payload."}], "methods": [{"name": "datetime _utcnow()", "description": "Returns the current UTC datetime.", "scope": "", "scopeKind": ""}, {"name": "UserPublic _to_user_public(user: User)", "description": "Converts a User object to its public representation.", "scope": "", "scopeKind": ""}, {"name": "UserPublic register_user(payload: RegisterRequest, db: Annotated[Session, Depends(get_db)])", "description": "API endpoint to register a new user, creating a User record and returning its public data.", "scope": "", "scopeKind": ""}, {"name": "TokenResponse login(payload: LoginRequest, db: Annotated[Session, Depends(get_db)])", "description": "Authenticates a user and generates access and refresh tokens.", "scope": "", "scopeKind": ""}, {"name": "TokenResponse refresh(payload: RefreshRequest, db: Annotated[Session, Depends(get_db)])", "description": "Refreshes access tokens using a valid refresh token, rotating tokens.", "scope": "", "scopeKind": ""}, {"name": "None logout(payload: LogoutRequest, db: Annotated[Session, Depends(get_db)])", "description": "Revokes a refresh token, effectively logging out the user.", "scope": "", "scopeKind": ""}], "calls": ["select(User).where(User.email == payload.email)", "db.execute(select(User).where(User.email == payload.email))", "hash_password(payload.password)", "verify_password(payload.password, user.password_hash)", "create_access_token(subject=str(user.id), role=user.role.value)", "create_refresh_token(subject=str(user.id))", "db.add(user)", "db.commit()", "db.refresh(user)", "select(RefreshToken).where(RefreshToken.token == payload.refresh_token)", "decode_token(payload.refresh_token)", "uuid.UUID(str(sub))", "db.get(User, user_id)", "db.delete(rt)"], "search-terms": ["auth registration", "token refresh", "refresh token management", "FastAPI auth routes", "user login", "logout endpoint", "JWT authentication", "refresh token rotation"], "state": 2, "file_id": 14, "knowledge_revision": 38, "git_revision": "faaaf9788eabe53a745ecabefd2fa21cff48c685", "ctags": [{"_type": "tag", "name": "_to_user_public", "path": "/home/kavia/workspace/code-generation/resident-directory-management-system-197923-197936/api_backend/src/api/routers/auth.py", "pattern": "/^def _to_user_public(user: User) -> UserPublic:$/", "language": "Python", "typeref": "typename:UserPublic", "kind": "function", "signature": "(user: User)"}, {"_type": "tag", "name": "_utcnow", "path": "/home/kavia/workspace/code-generation/resident-directory-management-system-197923-197936/api_backend/src/api/routers/auth.py", "pattern": "/^def _utcnow() -> datetime:$/", "language": "Python", "typeref": "typename:datetime", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "login", "path": "/home/kavia/workspace/code-generation/resident-directory-management-system-197923-197936/api_backend/src/api/routers/auth.py", "pattern": "/^def login(payload: LoginRequest, db: Annotated[Session, Depends(get_db)]) -> TokenResponse:$/", "language": "Python", "typeref": "typename:TokenResponse", "kind": "function", "signature": "(payload: LoginRequest, db: Annotated[Session, Depends(get_db)])"}, {"_type": "tag", "name": "logout", "path": "/home/kavia/workspace/code-generation/resident-directory-management-system-197923-197936/api_backend/src/api/routers/auth.py", "pattern": "/^def logout(payload: LogoutRequest, db: Annotated[Session, Depends(get_db)]) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(payload: LogoutRequest, db: Annotated[Session, Depends(get_db)])"}, {"_type": "tag", "name": "refresh", "path": "/home/kavia/workspace/code-generation/resident-directory-management-system-197923-197936/api_backend/src/api/routers/auth.py", "pattern": "/^def refresh(payload: RefreshRequest, db: Annotated[Session, Depends(get_db)]) -> TokenResponse:$/", "language": "Python", "typeref": "typename:TokenResponse", "kind": "function", "signature": "(payload: RefreshRequest, db: Annotated[Session, Depends(get_db)])"}, {"_type": "tag", "name": "register_user", "path": "/home/kavia/workspace/code-generation/resident-directory-management-system-197923-197936/api_backend/src/api/routers/auth.py", "pattern": "/^def register_user(payload: RegisterRequest, db: Annotated[Session, Depends(get_db)]) -> UserPubl/", "language": "Python", "typeref": "typename:UserPublic", "kind": "function", "signature": "(payload: RegisterRequest, db: Annotated[Session, Depends(get_db)])"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/resident-directory-management-system-197923-197936/api_backend/src/api/routers/auth.py", "pattern": "/^router = APIRouter(prefix=\"\\/auth\", tags=[\"auth\"])$/", "language": "Python", "kind": "variable"}], "hash": "579507c48b3cc5e8c33f215bb48775d6", "format-version": 4, "code-base-name": "api_backend", "filename": "api_backend/src/api/routers/auth.py", "fields": [{"name": "router = APIRouter(prefix=\"\\/auth\", tags=[\"auth\"])", "scope": "", "scopeKind": "", "description": "unavailable"}], "revision_history": [{"38": "faaaf9788eabe53a745ecabefd2fa21cff48c685"}]}